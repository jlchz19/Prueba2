{% extends "base.html" %}

{% block title %}Nueva Ubicación - AgroGest{% endblock %}
{% block page_title %}Nueva Ubicación{% endblock %}

{% block page_actions %}
<a href="{{ url_for('potreros') }}" class="btn btn-secondary">
    <i class="fas fa-arrow-left me-2"></i>Volver
</a>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-home me-2"></i>Crear Nueva Ubicación para Animales
            </div>
            <div class="card-body">
                <form method="POST" class="needs-validation" novalidate>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="nombre" name="nombre" required>
                                <label for="nombre">Nombre de la Ubicación *</label>
                                <div class="form-text">Ej: Cochiquera 1, Gallinero Principal, Establo Norte</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <select class="form-select" id="tipo_ubicacion" name="tipo_ubicacion" required>
                                    <option value="">Seleccionar tipo...</option>
                                    <option value="cochiquera">Cochiquera</option>
                                    <option value="gallinero">Gallinero</option>
                                    <option value="establo">Establo</option>
                                    <option value="corral">Corral</option>
                                    <option value="aprisco">Aprisco (Ovejas)</option>
                                    <option value="caballeriza">Caballeriza</option>
                                    <option value="conejera">Conejera</option>
                                </select>
                                <label for="tipo_ubicacion">Tipo de Ubicación *</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <select class="form-select" id="tipo_animal" name="tipo_animal" required>
                                    <option value="">Seleccionar animal...</option>
                                    <option value="Porcino">Porcino (Cerdos)</option>
                                    <option value="Aviar">Aviar (Gallinas, Pollos)</option>
                                    <option value="Equino">Equino (Caballos, Yeguas)</option>
                                    <option value="Ovino">Ovino (Ovejas)</option>
                                    <option value="Caprino">Caprino (Cabras)</option>
                                    <option value="Cunícola">Cunícola (Conejos)</option>
                                </select>
                                <label for="tipo_animal">Tipo de Animal *</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" id="capacidad" name="capacidad" min="1" required>
                                <label for="capacidad">Capacidad (Número de Animales) *</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" step="0.1" class="form-control" id="area" name="area">
                                <label for="area">Área (m²)</label>
                                <div class="form-text">Opcional</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <select class="form-select" id="estado" name="estado">
                                    <option value="disponible" selected>Disponible</option>
                                    <option value="ocupado">Ocupado</option>
                                    <option value="mantenimiento">En Mantenimiento</option>
                                </select>
                                <label for="estado">Estado</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-floating">
                                <textarea class="form-control" id="descripcion" name="descripcion" style="height: 100px"></textarea>
                                <label for="descripcion">Descripción</label>
                                <div class="form-text">Características especiales, equipamiento, etc.</div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end">
                        <a href="{{ url_for('potreros') }}" class="btn btn-secondary me-2">
                            <i class="fas fa-times me-2"></i>Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Crear Ubicación
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
/* Estilos específicos para mejorar la visibilidad de formularios */
.section-header {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    padding: 1.5rem;
    border-radius: 12px;
    border-left: 4px solid var(--primary);
    margin-bottom: 2rem;
}

.section-title {
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.section-subtitle {
    color: #6c757d;
    margin-bottom: 0;
    font-size: 0.95rem;
}

.form-floating {
    margin-bottom: 1rem;
}

.form-floating > .form-control,
.form-floating > .form-select {
    background-color: #fff;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 1rem;
    font-size: 1rem;
    height: calc(3.5rem + 2px);
    transition: all 0.3s ease;
}

.form-floating > .form-control:focus,
.form-floating > .form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.1);
    background-color: #fff;
}

.form-floating > label {
    padding: 1rem;
    font-weight: 500;
    color: #495057;
    background-color: transparent;
}

.form-text {
    font-size: 0.875rem;
    color: #6c757d;
    margin-top: 0.5rem;
    padding-left: 0.5rem;
}

.btn-group-custom {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 12px;
}

.btn-custom {
    min-width: 150px;
    padding: 12px 24px;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.card-body {
    padding: 2rem;
}

.row.g-4 > * {
    padding-left: 1rem;
    padding-right: 1rem;
}

/* Estilos para campos obligatorios */
.form-floating > .form-control[required],
.form-floating > .form-select[required] {
    border-left: 4px solid #ffc107;
}

.form-floating > .form-control[required]:focus,
.form-floating > .form-select[required]:focus {
    border-left: 4px solid var(--success);
}

.info-panel {
    background: linear-gradient(135deg, #e3f2fd, #f8f9fa);
    border: 1px solid #bbdefb;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.info-panel h6 {
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 1rem;
}

.info-panel ul {
    margin-bottom: 0;
    padding-left: 1.5rem;
}

.info-panel li {
    margin-bottom: 0.5rem;
    color: #495057;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });

    // Auto-sugerir tipo de animal según tipo de ubicación
    const tipoUbicacion = document.getElementById('tipo_ubicacion');
    const tipoAnimal = document.getElementById('tipo_animal');
    
    const sugerencias = {
        'cochiquera': 'Porcino',
        'gallinero': 'Aviar',
        'establo': 'Equino',
        'corral': 'Equino',
        'aprisco': 'Ovino',
        'caballeriza': 'Equino',
        'conejera': 'Cunícola'
    };
    
    tipoUbicacion.addEventListener('change', function() {
        const sugerencia = sugerencias[this.value];
        if (sugerencia) {
            tipoAnimal.value = sugerencia;
        }
    });

    // Pre-seleccionar según parámetro URL
    const urlParams = new URLSearchParams(window.location.search);
    const tipoParam = urlParams.get('tipo');
    if (tipoParam) {
        tipoUbicacion.value = tipoParam;
        const sugerencia = sugerencias[tipoParam];
        if (sugerencia) {
            tipoAnimal.value = sugerencia;
        }
    }
});
</script>
{% endblock %}
